(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[254],{7071:function(e,t,n){"use strict";var r=n(4246),a=n(3101),i=n(6982),o=n(5395),s=n(304),c=n(9183),l=n(3184),u=n(7105),d=n(7378),h=n(42),f=n.n(h),p=n(7915),m=n(8784),g=n.n(m),v=n(5545),y=n(1599);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,l.Z)(e);if(t){var a=(0,l.Z)(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return(0,c.Z)(this,n)}}var x=function(e){(0,s.Z)(n,e);var t=b(n);function n(e){var r;return(0,a.Z)(this,n),r=t.call(this,e),(0,u.Z)((0,o.Z)(r),"mounted",!1),(0,u.Z)((0,o.Z)(r),"updateDimensionsImmediate",(function(){if(r.mounted){var e=r.getContainerSize();if(e){var t=r.state,n=t.containerWidth,a=t.containerHeight,i=e.containerWidth,o=e.containerHeight;i===n&&o===a||r.setState({containerWidth:i,containerHeight:o})}}})),r.state={containerWidth:e.initialWidth||-1,containerHeight:e.initialHeight||-1},r.handleResize=e.debounce>0?g().debounce(r.updateDimensionsImmediate,e.debounce):r.updateDimensionsImmediate,r}return(0,i.Z)(n,[{key:"componentDidMount",value:function(){this.mounted=!0;var e=this.getContainerSize();e&&this.setState(e)}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"getContainerSize",value:function(){return this.container?{containerWidth:this.container.clientWidth,containerHeight:this.container.clientHeight}:null}},{key:"renderChart",value:function(){var e=this.state,t=e.containerWidth,n=e.containerHeight;if(t<0||n<0)return null;var r=this.props,a=r.aspect,i=r.width,o=r.height,s=r.minWidth,c=r.minHeight,l=r.maxHeight,u=r.children;(0,y.Z)((0,v.hU)(i)||(0,v.hU)(o),"The width(%s) and height(%s) are both fixed numbers,\n       maybe you don't need to use a ResponsiveContainer.",i,o),(0,y.Z)(!a||a>0,"The aspect(%s) must be greater than zero.",a);var h=(0,v.hU)(i)?t:i,f=(0,v.hU)(o)?n:o;return a&&a>0&&(h?f=h/a:f&&(h=f*a),l&&f>l&&(f=l)),(0,y.Z)(h>0||f>0,"The width(%s) and height(%s) of chart should be greater than 0,\n       please check the style of container, or the props width(%s) and height(%s),\n       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the\n       height and width.",h,f,i,o,s,c,a),d.cloneElement(u,{width:h,height:f})}},{key:"render",value:function(){var e=this,t=this.props,n=t.minWidth,a=t.minHeight,i=t.width,o=t.height,s=t.maxHeight,c=t.id,l=t.className,u={width:i,height:o,minWidth:n,minHeight:a,maxHeight:s};return(0,r.jsxs)("div",{id:c,className:f()("recharts-responsive-container",l),style:u,ref:function(t){e.container=t},children:[this.renderChart(),(0,r.jsx)(p.ZP,{handleWidth:!0,handleHeight:!0,onResize:this.handleResize})]})}}]),n}(d.Component);(0,u.Z)(x,"displayName","ResponsiveContainer"),(0,u.Z)(x,"defaultProps",{width:"100%",height:"100%",debounce:0}),t.Z=x},5e3:function(e,t,n){"use strict";n.r(t),n.d(t,{SqliteHttpvfsDemo:function(){return V},Store:function(){return K}});var r=n(4246),a=n(2657),i=n(8742),o=n.n(i),s=n(505),c=n(3101),l=n(6982),u=n(7105),d=(n(2909),n(312)),h=n(3365),f=n(1005),p=n(7378),m=n(1403),g=n.n(m),v=n(5889),y=n(2843),b=n(6420),x=n(7504),w=n.n(x),j=n(4983),S=n(412),k=n.n(S),_=n(5885),O=n(556),E=n(6299),N=n(2734),P=n(1296),C=n(1215),q=n(7071);function Z(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return I(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return I(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function I(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function A(){return(A=(0,s.Z)(o().mark((function e(t,n){var r,a,i,s,c,l;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n.length<3)){e.next=2;break}return e.abrupt("return",[{error:"Type more..."}]);case 2:return e.prev=2,e.next=5,t.ready;case 5:return r=e.sent,a=r.db,i=n.split(" ").map((function(e){return e.replace(/"/g,"")})).map((function(e){return'"'.concat(e,'"*')})).join(" "),s="".concat(i),c="select *, snippet(indicator_search, -1, '\xa7', '\xa7', ' ... ', 32) as snippet from indicator_search where indicator_search match ? order by rank limit 10",console.log("executing search query",s,c),e.next=13,a.query(c,[s]);case 13:return l=e.sent,e.abrupt("return",l);case 17:throw e.prev=17,e.t0=e.catch(2),console.error("authorsSearch",e.t0),e.t0;case 21:case"end":return e.stop()}}),e,null,[[2,17]])})))).apply(this,arguments)}var T=w()((function(e,t){return A.apply(this,arguments)}),250);function D(){return(D=(0,s.Z)(o().mark((function e(t,n){var r,a,i,s,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.ready;case 3:return r=e.sent,a=r.db,i="select short_name, country_code from wdi_country where long_name like ? or short_name like ? or country_code like ? limit 10",console.log("executing search query",i),s="%".concat(n,"%"),e.next=10,a.query(i,[s,s,s]);case 10:return c=e.sent,e.abrupt("return",c);case 14:throw e.prev=14,e.t0=e.catch(0),console.error("authorsSearch",e.t0),e.t0;case 18:case"end":return e.stop()}}),e,null,[[0,14]])})))).apply(this,arguments)}var R=w()((function(e,t){return D.apply(this,arguments)}),250);function H(e,t){if(e.error)return e.error;if("value"===t.context)return e.indicator_name;var n,i=[],o=Z(e.snippet.split("\xa7").entries());try{for(o.s();!(n=o.n()).done;){var s=(0,a.Z)(n.value,2),c=s[0],l=s[1];i.push(c%2==0?(0,r.jsx)("span",{children:l},c):(0,r.jsx)("b",{children:l},c))}}catch(u){o.e(u)}finally{o.f()}return(0,r.jsxs)(r.Fragment,{children:[e.indicator_name,(0,r.jsx)("br",{}),(0,r.jsx)("small",{children:e.topic}),(0,r.jsx)("br",{}),(0,r.jsx)("span",{style:{color:"gray"},children:i})]})}var M=[{short_name:"United States",country_code:"USA"},{short_name:"Germany",country_code:"DEU"},{short_name:"India",country_code:"IND"},{short_name:"China",country_code:"CHN"},{short_name:"Korea",country_code:"KOR"}],W={indicator_code:"IT.NET.USER.ZS",topic:"Infrastructure: Communications",indicator_name:"Individuals using the Internet (% of population)",short_definition:null,long_definition:"Internet users are individuals who have used the Internet (from any location) in the last 3 months. The Internet can be used via a computer, mobile phone, personal digital assistant, games machine, digital TV etc.",statistical_concept_and_methodology:"The Internet is a world-wide public computer network. It provides access to a number of communication services including the World Wide Web and carries email, news, entertainment and data files, irrespective of the device used (not assumed to be only via a computer - it may also be by mobile phone, PDA, games machine, digital TV etc.). Access can be via a fixed or mobile network. For additional/latest information on sources and country notes, please also refer to: https://www.itu.int/en/ITU-D/Statistics/Pages/stat/default.aspx",development_relevance:"The digital and information revolution has changed the way the world learns, communicates, does business, and treats illnesses. New information and communications technologies (ICT) offer vast opportunities for progress in all walks of life in all countries - opportunities for economic growth, improved health, better service delivery, learning through distance education, and social and cultural advances.\n\nToday's smartphones and tablets have computer power equivalent to that of yesterday's computers and provide a similar range of functions. Device convergence is thus rendering the conventional definition obsolete.\n\nComparable statistics on access, use, quality, and affordability of ICT are needed to formulate growth-enabling policies for the sector and to monitor and evaluate the sector's impact on development. Although basic access data are available for many countries, in most developing countries little is known about who uses ICT; what they are used for (school, work, business, research, government); and how they affect people and businesses. The global Partnership on Measuring ICT for Development is helping to set standards, harmonize information and communications technology statistics, and build statistical capacity in developing countries. However, despite significant improvements in the developing world, the gap between the ICT haves and have-nots remains.",snippet:""},z=["#7cb5ec","#434348","#90ed7d","#f7a35c","#8085e9","#f15c80","#e4d354","#2b908f","#f45b5b","#91e8e1"],F=function(e){var t=e.store,n=(0,p.useState)(!1),a=n[0],i=n[1],c=(0,p.useState)(M),l=c[0],u=c[1],d=(0,p.useState)(W),h=d[0],f=d[1],m=(0,p.useState)(null),g=m[0],v=m[1];function y(){return(y=(0,s.Z)(o().mark((function e(){var n,r,i,s,c,u,d,f;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return");case 2:if(0!==l.length&&h){e.next=5;break}return v(null),e.abrupt("return");case 5:return console.log("plot",l,h),e.next=8,t.ready;case 8:return n=e.sent,r=n.db,e.next=12,r.query("select short_name, year, value from wdi_data join wdi_country using (country_code) where country_code in (select value from json_each(?)) and indicator_code = ? order by year asc",[JSON.stringify(l.map((function(e){return e.country_code}))),h.indicator_code]);case 12:i=e.sent,s=new Map,c=Z(i);try{for(c.s();!(u=c.n()).done;)d=u.value,(f=s.get(d.year))||(f={year:d.year},s.set(d.year,f)),f[d.short_name]=d.value}catch(o){c.e(o)}finally{c.f()}console.log("plotres",i),v({series:l.map((function(e){return e.short_name})),data:(0,b.Z)(s.values())});case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,p.useEffect)((function(){!function(){y.apply(this,arguments)}()}),[h,l,a]),(0,r.jsx)(k(),{onChange:function(e){return i(e)},children:(0,r.jsxs)("div",{className:"sqlite-httpvfs-demo",children:["Countries:"," ",(0,r.jsx)(j.ZP,{value:l,cacheOptions:!0,defaultOptions:!0,isMulti:!0,loadOptions:function(e){return R(t,e)},getOptionLabel:function(e){return e.short_name},getOptionValue:function(e){return e.country_code},onChange:function(e){return u(e)}}),"Indicator:"," ",(0,r.jsx)(j.ZP,{value:h,cacheOptions:!0,defaultOptions:!0,loadOptions:function(e){return T(t,e)},getOptionLabel:function(e){return e.indicator_name},formatOptionLabel:H,getOptionValue:function(e){return e.indicator_code},onChange:function(e){return f(e)},isOptionDisabled:function(e){return!!e.error}}),g&&(0,r.jsx)(q.Z,{width:"100%",height:300,initialWidth:600,initialHeight:300,children:(0,r.jsxs)(_.w,{data:g.data,children:[(0,r.jsx)(O.K,{dataKey:"year"}),(0,r.jsx)(E.B,{}),(0,r.jsx)(N.u,{}),(0,r.jsx)(P.D,{}),g.series.map((function(e,t){return(0,r.jsx)(C.x,{type:"monotone",dataKey:e,name:e,stroke:z[t%z.length],connectNulls:!0,strokeWidth:3},e)}))]})}),(0,r.jsxs)("details",{children:[(0,r.jsx)("summary",{children:"Extra information about this indicator"}),(0,r.jsxs)("dl",{className:"maxheight",children:[(0,r.jsx)("dt",{children:"Indicator Code"}),(0,r.jsx)("dd",{children:null===h||void 0===h?void 0:h.indicator_code}),(0,r.jsx)("dt",{children:"Long definition"}),(0,r.jsx)("dd",{children:null===h||void 0===h?void 0:h.long_definition}),(0,r.jsx)("dt",{children:"Statistical concept and methodology"}),(0,r.jsx)("dd",{children:null===h||void 0===h?void 0:h.statistical_concept_and_methodology}),(0,r.jsx)("dt",{children:"Development relevance"}),(0,r.jsx)("dd",{children:null===h||void 0===h?void 0:h.development_relevance})]})]})]})})};function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){(0,u.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function U(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return G(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return G(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function G(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}g().setAppElement(".lh-copy");var $,K=function(){function e(){(0,c.Z)(this,e),(0,u.Z)(this,"worker",null),(0,u.Z)(this,"error",""),(0,u.Z)(this,"ready",void 0),(0,u.Z)(this,"statsConnected",!1),Object.assign(window,{httpvfs:this}),this.ready=this.init()}return(0,l.Z)(e,[{key:"init",value:function(){var e=(0,s.Z)(o().mark((function e(){var t,n,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/blog/sqlite.worker.js","/blog/sql-wasm.wasm",r=new URLSearchParams(location.search).get("dbUrl")||"/world-development-indicators-sqlite/split-db",e.next=5,(0,v.createDbWorker)([{from:"jsonconfig",virtualFilename:"wdi.sqlite3",configUrl:r+"/config.json"},{from:"inline",virtualFilename:"dbstat.sqlite3",config:{serverMode:"full",requestChunkSize:4096,url:r+"/dbstat.sqlite3"}}],"/blog/sqlite.worker.js".toString(),"/blog/sql-wasm.wasm".toString());case 5:return this.worker=e.sent,e.next=8,null===(t=$.worker)||void 0===t?void 0:t.db.query("select * from sqlite_master");case 8:return e.next=10,null===(n=$.worker)||void 0===n?void 0:n.worker.evalCode('\n\t\t\tfunction getFlag(country_code) {\n\t\t\t\t// just some unicode magic\n\t\t\t\treturn String.fromCodePoint(...Array.from(country_code||"")\n\t\t\t\t\t.map(c => 127397 + c.codePointAt()));\n\t\t\t}\n\t\t\t\n\t\t\tawait db.create_function("get_flag", getFlag)');case 10:return e.abrupt("return",this.worker);case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function J(){return $||($=new K),$}var V=function(e){var t,n,i=J(),c={},l=U((null===(t=e.className)||void 0===t?void 0:t.split(" "))||[]);try{for(l.s();!(n=l.n()).done;){var u=n.value;c[u]=!0}}catch(B){l.e(B)}finally{l.f()}if(c.ftsDemo)return(0,r.jsx)(F,{store:i});p.useEffect((function(){c.autorun&&W()}),[]);var f,m=p.useState(e.value),g=(0,a.Z)(m,2),v=g[0],b=g[1],x=p.useState(""),w=(0,a.Z)(x,2),j=w[0],S=w[1],k=p.useState(null),_=(0,a.Z)(k,2),O=_[0],E=_[1],N=p.useState(null),P=(0,a.Z)(N,2),C=P[0],q=P[1],Z=p.useState(!1),I=(0,a.Z)(Z,2),A=I[0],T=I[1],D=p.useState(100),R=(0,a.Z)(D,2),H=R[0],M=R[1];function W(){return z.apply(this,arguments)}function z(){return(z=(0,s.Z)(o().mark((function e(){var t,n,a,s,l,u,d,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S("[running...]"),t=c.js||!1,console.log("running",v),e.prev=3,e.next=6,i.ready;case 6:if(n=e.sent,a=n.db,s=n.worker,!c.diffstat){e.next=13;break}return e.next=12,s.getStats();case 12:l=e.sent;case 13:if(!c.logPageReads){e.next=16;break}return e.next=16,s.getResetAccessedPages();case 16:return e.next=18,t?s.evalCode(v):a.query(v);case 18:if(u=e.sent,(d=JSON.stringify(u,null,2))||(d="[no output, make sure your last statement has `return` before it]"),d.length>5e4&&(d=d.slice(0,5e4)+"\n[... (output truncated, total length ".concat(d.length,")]")),S(d),!c.diffstat){e.next=28;break}return e.next=26,s.getStats();case 26:h=e.sent,l&&h&&E({filename:h.filename,totalBytes:h.totalBytes,totalFetchedBytes:h.totalFetchedBytes-l.totalFetchedBytes,totalRequests:h.totalRequests-l.totalRequests});case 28:if(!c.logPageReads){e.next=34;break}return e.t0=q,e.next=32,s.getResetAccessedPages();case 32:e.t1=e.sent,(0,e.t0)(e.t1);case 34:e.next=39;break;case 36:e.prev=36,e.t2=e.catch(3),String(e.t2).includes("SharedArrayBuffer")?S((0,r.jsxs)(r.Fragment,{children:["[error: ",String(e.t2),"]",(0,r.jsx)("br",{}),"Your browser might either be too old to support SharedArrayBuffer, or too new and have some Spectre protections enabled that don't work on GitHub Pages since they don't allow setting the necessary isolation headers. Try going to"," ",(0,r.jsx)("a",{href:"https://phiresky.netlify.app/blog/2021/hosting-sqlite-databases-on-github-pages/",children:"the Netlify mirror of this blog"})," ","for the DOM demos."]})):S("[error: ".concat(String(e.t2),"]"));case 39:case"end":return e.stop()}}),e,null,[[3,36]])})))).apply(this,arguments)}return f=j?"string"===typeof j?(0,r.jsx)(y.Z,{className:"inner-body maxheight",language:"json",wrap:!0,value:j}):(0,r.jsx)("div",{className:"like-codeblock",children:j}):(0,r.jsx)("div",{style:{paddingBottom:"1ex"}}),(0,r.jsxs)("div",{className:"sqlite-httpvfs-demo",children:[(0,r.jsxs)("div",{className:"box-title",children:[c.js?"JS ":"","Demo"]}),(0,r.jsxs)("div",{className:"with-inner-title",children:[(0,r.jsxs)("div",{className:"inner-title",children:[(0,r.jsxs)("div",{children:["Input ",c.js?"JavaScript":"SQL"]}),(0,r.jsx)("div",{role:"button",className:"floatright",onClick:function(){A||(q(null),E(null),S("")),T(!A)},children:A?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h.G,{icon:d.r6l,size:"sm"})," Save"]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(h.G,{icon:d.UFh,size:"sm"})," Edit"]})})]}),A?(0,r.jsx)("textarea",{spellCheck:!1,className:"like-codeblock inner-body",style:{height:H},value:v,onChange:function(e){return b(e.currentTarget.value)}}):(0,r.jsx)("div",{className:"inner-body",ref:function(e){return e&&M(null===e||void 0===e?void 0:e.clientHeight)},children:(0,r.jsx)(y.Z,{className:"inner-body",language:c.js?"typescript":"sql",wrap:!0,value:v})})]}),(0,r.jsxs)("div",{className:"with-inner-title hanging",children:[(0,r.jsx)("div",{className:"inner-title",children:j?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{children:"Output JSON"})," ",(0,r.jsxs)("div",{role:"button",onClick:W,className:"floatright",children:[(0,r.jsx)(h.G,{icon:d.zc,size:"sm"})," Rerun"]})]}):(0,r.jsxs)("div",{role:"button",onClick:W,children:[(0,r.jsx)(h.G,{icon:d.zc,size:"sm"})," Run"]})}),f]}),c.diffstat&&O&&(0,r.jsx)(Y,{stats:O,readPages:C,defaultFlipped:c.defaultPageReadTable})]})};function X(e){return e>1e6?(e/1e6).toFixed(1)+"MB":e>1e3?(e/1e3).toFixed(1)+"KB":"".concat(e,"B")}var Y=(0,f.Pi)((function(e){var t=e.stats,n=e.readPages,i=e.defaultFlipped,c=J(),l=p.useState(!1),u=(0,a.Z)(l,2),f=u[0],m=u[1],g=p.useState(!1),v=(0,a.Z)(g,2),y=v[0],b=v[1],x=p.useState("Loading..."),w=(0,a.Z)(x,2),j=w[0],S=w[1];function k(){return _.apply(this,arguments)}function _(){return(_=(0,s.Z)(o().mark((function e(){var t,r,a,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f){e.next=3;break}return m(!1),e.abrupt("return");case 3:return m(!0),b(!0),e.next=7,c.ready;case 7:if(t=e.sent,r=t.db,n){e.next=11;break}return e.abrupt("return");case 11:if(e.prev=11,c.statsConnected){e.next=16;break}return e.next=15,r.query("attach 'dbstat.sqlite3' as stat");case 15:c.statsConnected=!0;case 16:return e.next=18,r.query("\n\t\t\t\tselect *, n.name, t.name as pagetype from stat.stat s\n\t\t\t\tjoin stat.names n on n.id = s.name\n\t\t\t\tjoin stat.pagetypes t on t.id = s.pagetype \n\t\t\t\twhere pageno in (".concat(n.map((function(e){return e.pageno})).join(","),")\n\t\t\t"));case 18:a=e.sent,i=new Map(a.map((function(e){return[e.pageno,e]}))),S(n.map((function(e){var t=i.get(e.pageno);return L(L({},e),{},{page:t})}))),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(11),console.error(e.t0),S(String(e.t0));case 27:case"end":return e.stop()}}),e,null,[[11,23]])})))).apply(this,arguments)}return p.useEffect((function(){i&&!f&&n&&!y&&(console.log("showing effect"),k())}),[i,f,n,y]),(0,r.jsx)("div",{className:"flip-box ".concat(f?"flipped":"unflipped"),children:(0,r.jsxs)("div",{className:"flip-box-inner",children:[(0,r.jsx)("div",{className:"flip-box-front",children:(0,r.jsxs)("div",{className:"with-inner-title hanging",children:[(0,r.jsxs)("div",{className:"inner-title",children:[(0,r.jsx)("div",{children:"Sqlite stats"}),n&&(0,r.jsxs)("div",{role:"button",className:"floatright",onClick:k,children:[(0,r.jsx)(h.G,{icon:d.sqG})," Show page read log (",n.length," reads)"]})]}),(0,r.jsxs)("div",{className:"inner-body like-codeblock",children:["fetched ",X(t.totalFetchedBytes)," in"," ",t.totalRequests," requests (DB size:"," ",X(t.totalBytes),")"]})]})}),(0,r.jsx)("div",{className:"flip-box-back",children:(0,r.jsxs)("div",{className:"with-inner-title hanging",children:[(0,r.jsxs)("div",{className:"inner-title",children:[(0,r.jsx)("div",{children:"Sqlite Page Read Requests"}),n&&(0,r.jsxs)("div",{role:"button",className:"floatright",onClick:k,children:[(0,r.jsx)(h.G,{icon:d.sqG})," Back to stats"]})]}),(0,r.jsx)("div",{className:"inner-body page-list maxheight",children:j&&(0,r.jsx)(Q,{pages:j})})]})})]})})})),Q=(0,f.Pi)((function(e){var t=e.pages;return 0===t.length?(0,r.jsx)(r.Fragment,{children:"[no data pages requested]"}):"string"===typeof t?(0,r.jsx)(r.Fragment,{children:t}):(0,r.jsxs)("table",{children:[(0,r.jsx)("thead",{children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{children:"Page"}),(0,r.jsx)("th",{children:"Cache"}),(0,r.jsx)("th",{children:"Access pattern"}),(0,r.jsx)("th",{children:"Table / Index"}),(0,r.jsx)("th",{children:"Page Type"})]})}),(0,r.jsx)("tbody",{children:t.map((function(e,t){var n,a,i;return(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:e.pageno}),(0,r.jsx)("td",{children:e.wasCached?"hit":"miss"}),(0,r.jsx)("td",{children:e.wasCached?"":(e.prefetch?"sequential, prefetch ".concat(e.prefetch," pages"):"random")+" (".concat(e.prefetch+1," KiB XHR)")}),(0,r.jsx)("td",{children:null!==(n=null===(a=e.page)||void 0===a?void 0:a.name)&&void 0!==n?n:"[system]"}),(0,r.jsx)("td",{children:null===(i=e.page)||void 0===i?void 0:i.pagetype})]},t)}))})]})}))},5889:function(e){e.exports=(()=>{"use strict";var e={870:(e,t,n)=>{n.r(t),n.d(t,{createEndpoint:()=>a,expose:()=>l,proxy:()=>v,proxyMarker:()=>r,releaseProxy:()=>i,transfer:()=>g,transferHandlers:()=>c,windowEndpoint:()=>y,wrap:()=>d});const r=Symbol("Comlink.proxy"),a=Symbol("Comlink.endpoint"),i=Symbol("Comlink.releaseProxy"),o=Symbol("Comlink.thrown"),s=e=>"object"==typeof e&&null!==e||"function"==typeof e,c=new Map([["proxy",{canHandle:e=>s(e)&&e[r],serialize(e){const{port1:t,port2:n}=new MessageChannel;return l(e,t),[n,[n]]},deserialize:e=>(e.start(),d(e))}],["throw",{canHandle:e=>s(e)&&o in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function l(e,t=self){t.addEventListener("message",(function n(r){if(!r||!r.data)return;const{id:a,type:i,path:s}=Object.assign({path:[]},r.data),c=(r.data.argumentList||[]).map(x);let d;try{const t=s.slice(0,-1).reduce(((e,t)=>e[t]),e),n=s.reduce(((e,t)=>e[t]),e);switch(i){case 0:d=n;break;case 1:t[s.slice(-1)[0]]=x(r.data.value),d=!0;break;case 2:d=n.apply(t,c);break;case 3:d=v(new n(...c));break;case 4:{const{port1:t,port2:n}=new MessageChannel;l(e,n),d=g(t,[t])}break;case 5:d=void 0}}catch(e){d={value:e,[o]:0}}Promise.resolve(d).catch((e=>({value:e,[o]:0}))).then((e=>{const[r,o]=b(e);t.postMessage(Object.assign(Object.assign({},r),{id:a}),o),5===i&&(t.removeEventListener("message",n),u(t))}))})),t.start&&t.start()}function u(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function d(e,t){return f(e,[],t)}function h(e){if(e)throw new Error("Proxy has been released and is not useable")}function f(e,t=[],n=function(){}){let r=!1;const o=new Proxy(n,{get(n,a){if(h(r),a===i)return()=>w(e,{type:5,path:t.map((e=>e.toString()))}).then((()=>{u(e),r=!0}));if("then"===a){if(0===t.length)return{then:()=>o};const n=w(e,{type:0,path:t.map((e=>e.toString()))}).then(x);return n.then.bind(n)}return f(e,[...t,a])},set(n,a,i){h(r);const[o,s]=b(i);return w(e,{type:1,path:[...t,a].map((e=>e.toString())),value:o},s).then(x)},apply(n,i,o){h(r);const s=t[t.length-1];if(s===a)return w(e,{type:4}).then(x);if("bind"===s)return f(e,t.slice(0,-1));const[c,l]=p(o);return w(e,{type:2,path:t.map((e=>e.toString())),argumentList:c},l).then(x)},construct(n,a){h(r);const[i,o]=p(a);return w(e,{type:3,path:t.map((e=>e.toString())),argumentList:i},o).then(x)}});return o}function p(e){const t=e.map(b);return[t.map((e=>e[0])),(n=t.map((e=>e[1])),Array.prototype.concat.apply([],n))];var n}const m=new WeakMap;function g(e,t){return m.set(e,t),e}function v(e){return Object.assign(e,{[r]:!0})}function y(e,t=self,n="*"){return{postMessage:(t,r)=>e.postMessage(t,n,r),addEventListener:t.addEventListener.bind(t),removeEventListener:t.removeEventListener.bind(t)}}function b(e){for(const[t,n]of c)if(n.canHandle(e)){const[r,a]=n.serialize(e);return[{type:3,name:t,value:r},a]}return[{type:0,value:e},m.get(e)||[]]}function x(e){switch(e.type){case 3:return c.get(e.name).deserialize(e.value);case 0:return e.value}}function w(e,t,n){return new Promise((r=>{const a=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(n){n.data&&n.data.id&&n.data.id===a&&(e.removeEventListener("message",t),r(n.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:a},t),n)}))}},162:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return a(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.createDbWorker=void 0;const o=i(n(870));async function s(e){if(e.data&&"eval"===e.data.action){const n=new Int32Array(e.data.notify,0,2),r=new Uint8Array(e.data.notify,8);let a;try{a={ok:await u(e.data.request)}}catch(t){console.error("worker request error",e.data.request,t),a={err:String(t)}}const i=(new TextEncoder).encode(JSON.stringify(a));r.set(i,0),n[1]=i.length,Atomics.notify(n,0)}}function c(e){if("BODY"===e.tagName)return"body";const t=[];for(;e.parentElement&&"BODY"!==e.tagName;){if(e.id){t.unshift("#"+e.id);break}{let n=1,r=e;for(;r.previousElementSibling;)r=r.previousElementSibling,n++;t.unshift(e.tagName.toLowerCase()+":nth-child("+n+")")}e=e.parentElement}return t.join(" > ")}function l(e){return Object.keys(e)}async function u(e){if(console.log("dom vtable request",e),"select"===e.type)return[...document.querySelectorAll(e.selector)].map((t=>{const n={};for(const r of e.columns)"selector"===r?n.selector=c(t):"parent"===r?t.parentElement&&(n.parent=t.parentElement?c(t.parentElement):null):"idx"===r||(n[r]=t[r]);return n}));if("insert"===e.type){if(!e.value.parent)throw Error('"parent" column must be set when inserting');const t=document.querySelectorAll(e.value.parent);if(0===t.length)throw Error(`Parent element ${e.value.parent} could not be found`);if(t.length>1)throw Error(`Parent element ${e.value.parent} ambiguous (${t.length} results)`);const n=t[0];if(!e.value.tagName)throw Error("tagName must be set for inserting");const r=document.createElement(e.value.tagName);for(const a of l(e.value))if(null!==e.value[a]){if("tagName"===a||"parent"===a)continue;if("idx"===a||"selector"===a)throw Error(`${a} can't be set`);r[a]=e.value[a]}return n.appendChild(r),null}if("update"===e.type){const t=document.querySelector(e.value.selector);if(!t)throw Error(`Element ${e.value.selector} not found!`);const n=[];for(const r of l(e.value)){const a=e.value[r];if("parent"!==r){if("idx"!==r&&"selector"!==r&&a!==t[r]){if(console.log("SETTING ",r,t[r],"->",a),"tagName"===r)throw Error("can't change tagName");n.push(r)}}else if(a!==c(t.parentElement)){const e=document.querySelectorAll(a);if(1!==e.length)throw Error(`Invalid target parent: found ${e.length} matches`);e[0].appendChild(t)}}for(const r of n)t[r]=e.value[r];return null}throw Error(`unknown request ${e.type}`)}o.transferHandlers.set("WORKERSQLPROXIES",{canHandle:e=>!1,serialize(e){throw Error("no")},deserialize:e=>(e.start(),o.wrap(e))}),t.createDbWorker=async function(e,t,n){const r=new Worker(t),a=o.wrap(r),i=await a.SplitFileHttpDatabase(n,e);return r.addEventListener("message",s),{db:i,worker:a,configs:e}}},432:function(e,t,n){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),a(n(162),t)}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={exports:{}};return e[r].call(i.exports,i,i.exports,n),i.exports}return n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(432)})()}}]);