<!DOCTYPE html><html><head><meta charSet="utf-8"/><title>Hosting SQLite databases on Github Pages - (or any static file hoster) - phiresky&#x27;s blog</title><meta name="description" content="I was writing a tiny website to display statistics of how much sponsored content a Youtube creator has over time when I noticed that I often write a small tool as a website that queries some data from a database and then displays it in a graph, a table, or similar. But if you want to use a"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="alternate" type="application/rss+xml" title="RSS feed of phiresky&#x27;s blog" href="https://phiresky.github.io/blog/rss.xml"/><link rel="alternate" type="application/atom+xml" title="Atom feed of phiresky&#x27;s blog" href="https://phiresky.github.io/blog/atom.xml"/><link rel="alternate" type="application/json" title="JSON feed of phiresky&#x27;s blog" href="https://phiresky.github.io/blog/feed.json"/><style>
          body {
            font-family: -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Fira Sans,Droid Sans,Helvetica Neue,sans-serif;
          }
      </style><meta name="next-head-count" content="8"/><link rel="preload" href="/blog/_next/static/css/3acfbf97185f61973398.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/3acfbf97185f61973398.css" data-n-g=""/><link rel="preload" href="/blog/_next/static/css/9a8c5454fc7ac515a9fa.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/9a8c5454fc7ac515a9fa.css" data-n-g=""/><link rel="preload" href="/blog/_next/static/css/5010e8538e0af805e524.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/5010e8538e0af805e524.css" data-n-p=""/><link rel="preload" href="/blog/_next/static/css/efc250f8fd9fadf4c2cd.css" as="style"/><link rel="stylesheet" href="/blog/_next/static/css/efc250f8fd9fadf4c2cd.css"/><noscript data-n-css=""></noscript><link rel="preload" href="/blog/_next/static/chunks/framework-f2b6a0e2c4347cd67771.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/d9daaaae.44a96f54a4d072574e74.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/9598fa14.8828868ff96a6326c25a.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/186.2695ab59e33fe47cdc32.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/305.3a2900c6989f0f36c437.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/webpack-876742803a46f28db309.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/framework-f2b6a0e2c4347cd67771.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/commons-020e121c3d1a2701efcc.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/main-474bf01cc279f00c3383.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/pages/_app-c1531b3097afafc34a15.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/247-03c5f887de49cc28342f.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/120-4c18c374c3271b149473.js" as="script"/><link rel="preload" href="/blog/_next/static/chunks/pages/%5Byear%5D/%5Bpost%5D-d896f37a01124ade98ac.js" as="script"/></head><body><div id="__next"><div class="jsx-2809278127"><div><main class="lh-copy"><div class="relative tc bg-dark-gray"><div class="mw7 center white"><div class="pv4"><h1 class="f2 normal lh-title ma0 pa0"><a class="white no-underline" href="/blog/">phiresky&#x27;s blog</a></h1><h4 class="normal o-70 ma0 pt2 pb3 ph1">About my personal projects and other stuff</h4><div><a href="https://phiresky.github.io/blog/" class="dib f6 white no-underline pa1 ma1">Blog</a><a href="https://github.com/phiresky/" class="dib f6 white no-underline pa1 ma1">GitHub</a></div></div></div></div><div class="jsx-2809278127 content center mw7 pa3 pa4-ns"><h1 class="jsx-2809278127 mt0 lh-title mb1">Hosting SQLite databases on Github Pages</h1><p class="jsx-2809278127 mt0">(or any static file hoster)</p><small class="db ttu o-40"><time dateTime="2021-04-17T00:00:00.000Z">Apr 17, 2021</time></small><p>I was writing <a href="https://phiresky.github.io/youtube-sponsorship-stats/?uploader=Adam+Ragusea" attrs="[object Object]">a tiny website to display statistics of how much sponsored content a Youtube creator has over time</a> when I noticed that I often write a small tool as a website that queries some data from a database and then displays it in a graph, a table, or similar. But if you want to use a database, you either need to write a backend (which you then need to host forever) or download the whole dataset into the browser (which is not so great when the dataset is more than 10MB).</p><p>In the past when I’ve used a backend server for these small side projects at some point some API goes down or a key expires or I forget about the backend and stop paying for whatever VPS it was on. Then when I revisit it years later, I’m annoyed that it’s gone and curse myself for relying on some external service (or myself caring over a longer period of time).</p><p>Hosting a static website is much easier than a backend server - there’s many free and reliable options (like GitHub, GitLab Pages, Netlify, etc), and it scales to basically infinity without any effort.</p><p>So I wrote a tool to be able to use an SQL database in a statically hosted website!</p><p>Here’s a demo using the <a href="https://github.com/phiresky/world-development-indicators-sqlite/" attrs="[object Object]">World Development Indicators dataset</a> - a dataset with 6 tables and over 8 million rows (600MByte total).</p><div class="sqlite-httpvfs-demo"><div class="box-title">Demo</div><div class="with-inner-title"><div class="inner-title"><div>Input SQL</div><div role="button" class="floatright"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="keyboard" class="svg-inline--fa fa-keyboard fa-w-18 fa-sm " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"></path></svg> Edit</div></div><pre class="inner" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-sql" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre-wrap;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="token token" style="color:#cc99cd">select</span><span> country_code</span><span class="token token" style="color:#ccc">,</span><span> long_name </span><span class="token token" style="color:#cc99cd">from</span><span> wdi_country </span><span class="token token" style="color:#cc99cd">limit</span><span> </span><span class="token token" style="color:#f08d49">3</span><span class="token token" style="color:#ccc">;</span></span></code></pre></div><div class="with-inner-title hanging"><div class="inner-title"><div role="button"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play" class="svg-inline--fa fa-play fa-w-14 fa-sm " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"></path></svg> Run</div></div><div style="padding-bottom:1ex"></div></div></div><p>As you can see, we can query the <code attrs="[object Object]">wdi_country</code> table while only using 33kB of data!</p><p>This is a full SQLite query engine. As such, we can use e.g. the <a href="https://www.sqlite.org/json1.html" attrs="[object Object]">JSON functions</a> on our database:</p><div class="sqlite-httpvfs-demo"><div class="box-title">Demo</div><div class="with-inner-title"><div class="inner-title"><div>Input SQL</div><div role="button" class="floatright"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="keyboard" class="svg-inline--fa fa-keyboard fa-w-18 fa-sm " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"></path></svg> Edit</div></div><pre class="inner" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-sql" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre-wrap;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="token token" style="color:#cc99cd">select</span><span> json_extract</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;{&quot;foo&quot;: {&quot;bar&quot;: 123}}&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;$.foo.bar&#x27;</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#cc99cd">as</span><span> </span><span class="token token" style="color:#cc99cd">value</span></span></code></pre></div><div class="with-inner-title hanging"><div class="inner-title"><div role="button"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play" class="svg-inline--fa fa-play fa-w-14 fa-sm " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"></path></svg> Run</div></div><div style="padding-bottom:1ex"></div></div></div><p>Note that this website is 100% hosted on a static file hoster (GitHub Pages).</p><p>So how do you use a database on a static file hoster? Firstly, SQLite is compiled to WebAssembly. SQLite can be compiled with EMScripten without any modifications, and the <a href="https://github.com/sql-js/sql.js/" attrs="[object Object]">sql.js</a> library is a thin JS wrapper around the wasm code.</p><p>sql.js only allows you to create and read from databases that are fully in memory though - so I implemented a virtual file system that fetches chunks of the database with HTTP Range requests when SQLite tries to read from the filesystem. From SQLite’s perspective, it just looks like it’s living on a normal computer with an empty filesystem except for a file called <code attrs="[object Object]">/wdi.sqlite3</code> that it can read from.</p><p>[info about pages / page sizes]</p><p>Here’s an example of a simple index lookup query:</p><div class="sqlite-httpvfs-demo"><div class="box-title">Demo</div><div class="with-inner-title"><div class="inner-title"><div>Input SQL</div><div role="button" class="floatright"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="keyboard" class="svg-inline--fa fa-keyboard fa-w-18 fa-sm " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"></path></svg> Edit</div></div><pre class="inner" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-sql" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre-wrap;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="token token" style="color:#cc99cd">select</span><span> indicator_code </span><span class="token token" style="color:#cc99cd">from</span><span> wdi_series </span><span class="token token" style="color:#cc99cd">where</span><span> indicator_name
</span></span><span><span>    </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#7ec699">&#x27;Literacy rate, youth total (% of people ages 15-24)&#x27;</span></span></code></pre></div><div class="with-inner-title hanging"><div class="inner-title"><div role="button"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play" class="svg-inline--fa fa-play fa-w-14 fa-sm " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"></path></svg> Run</div></div><div style="padding-bottom:1ex"></div></div></div><p>Run the above query and look at the page read log. SQLite does 7 page reads for that query.</p><ul><li>Three page reads are just schema reads (that are already cached)</li><li>Two page reads are the index lookup in the index <code attrs="[object Object]">on wdi_series (indicator_name)</code></li><li>Two page reads are on the <code attrs="[object Object]">wdi_series</code> table data.</li></ul><p>Both the index as well as the table reads are B-Tree lookups.</p><p>A more complex query: What are countries with the lowest youth literacy rate, based on the newest data from after 2010?</p><div class="sqlite-httpvfs-demo"><div class="box-title">Demo</div><div class="with-inner-title"><div class="inner-title"><div>Input SQL</div><div role="button" class="floatright"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="keyboard" class="svg-inline--fa fa-keyboard fa-w-18 fa-sm " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"></path></svg> Edit</div></div><pre class="inner" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-sql" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre-wrap;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="token token" style="color:#cc99cd">with</span><span> newest_datapoints </span><span class="token token" style="color:#cc99cd">as</span><span> </span><span class="token token" style="color:#ccc">(</span><span>
</span></span><span><span>  </span><span class="token token" style="color:#cc99cd">select</span><span> country_code</span><span class="token token" style="color:#ccc">,</span><span> indicator_code</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">max</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#cc99cd">year</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#cc99cd">as</span><span> </span><span class="token token" style="color:#cc99cd">year</span><span> </span><span class="token token" style="color:#cc99cd">from</span><span> wdi_data
</span></span><span><span>  </span><span class="token token" style="color:#cc99cd">join</span><span> wdi_series </span><span class="token token" style="color:#cc99cd">using</span><span> </span><span class="token token" style="color:#ccc">(</span><span>indicator_code</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span>  </span><span class="token token" style="color:#cc99cd">where</span><span>
</span></span><span><span>    indicator_name </span><span class="token token" style="color:#67cdcc">=</span><span> </span><span class="token token" style="color:#7ec699">&#x27;Literacy rate, youth total (% of people ages 15-24)&#x27;</span><span>
</span></span><span><span>    </span><span class="token token" style="color:#67cdcc">and</span><span> </span><span class="token token" style="color:#cc99cd">year</span><span> </span><span class="token token" style="color:#67cdcc">&gt;</span><span> </span><span class="token token" style="color:#f08d49">2010</span><span>
</span></span><span><span>  </span><span class="token token" style="color:#cc99cd">group</span><span> </span><span class="token token" style="color:#cc99cd">by</span><span> country_code
</span></span><span><span></span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span></span><span class="token token" style="color:#cc99cd">select</span><span> c</span><span class="token token" style="color:#ccc">.</span><span>long_name </span><span class="token token" style="color:#cc99cd">as</span><span> country</span><span class="token token" style="color:#ccc">,</span><span> printf</span><span class="token token" style="color:#ccc">(</span><span class="token token" style="color:#7ec699">&#x27;%.1f %%&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#cc99cd">value</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#cc99cd">as</span><span> </span><span class="token token" style="color:#7ec699">&quot;Youth Literacy Rate&quot;</span><span>
</span></span><span><span></span><span class="token token" style="color:#cc99cd">from</span><span> wdi_data
</span></span><span><span>  </span><span class="token token" style="color:#cc99cd">join</span><span> wdi_country c </span><span class="token token" style="color:#cc99cd">using</span><span> </span><span class="token token" style="color:#ccc">(</span><span>country_code</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span>  </span><span class="token token" style="color:#cc99cd">join</span><span> newest_datapoints </span><span class="token token" style="color:#cc99cd">using</span><span> </span><span class="token token" style="color:#ccc">(</span><span>indicator_code</span><span class="token token" style="color:#ccc">,</span><span> country_code</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#cc99cd">year</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span></span><span class="token token" style="color:#cc99cd">order</span><span> </span><span class="token token" style="color:#cc99cd">by</span><span> </span><span class="token token" style="color:#cc99cd">value</span><span> </span><span class="token token" style="color:#cc99cd">asc</span><span> </span><span class="token token" style="color:#cc99cd">limit</span><span> </span><span class="token token" style="color:#f08d49">10</span></span></code></pre></div><div class="with-inner-title hanging"><div class="inner-title"><div role="button"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play" class="svg-inline--fa fa-play fa-w-14 fa-sm " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"></path></svg> Run</div></div><div style="padding-bottom:1ex"></div></div></div><p>The above query should do around 30 GET requests, fetching a total of 200KiB.</p><div class="sqlite-httpvfs-demo"><div class="box-title">Demo</div><div class="with-inner-title"><div class="inner-title"><div>Input SQL</div><div role="button" class="floatright"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="keyboard" class="svg-inline--fa fa-keyboard fa-w-18 fa-sm " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"></path></svg> Edit</div></div><pre class="inner" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-sql" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre-wrap;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="token token" style="color:#cc99cd">select</span><span> </span><span class="token token" style="color:#f08d49">sum</span><span class="token token" style="color:#ccc">(</span><span>length</span><span class="token token" style="color:#ccc">(</span><span>long_definition</span><span class="token token" style="color:#ccc">)</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#cc99cd">from</span><span> wdi_series</span><span class="token token" style="color:#ccc">;</span></span></code></pre></div><div class="with-inner-title hanging"><div class="inner-title"><div role="button"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play" class="svg-inline--fa fa-play fa-w-14 fa-sm " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"></path></svg> Run</div></div><div style="padding-bottom:1ex"></div></div></div><div class="sqlite-httpvfs-demo"><div class="box-title">Demo</div><div class="with-inner-title"><div class="inner-title"><div>Input SQL</div><div role="button" class="floatright"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="keyboard" class="svg-inline--fa fa-keyboard fa-w-18 fa-sm " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"></path></svg> Edit</div></div><pre class="inner" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-sql" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre-wrap;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="token token" style="color:#cc99cd">select</span><span> snippet</span><span class="token token" style="color:#ccc">(</span><span>indicator_search</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#67cdcc">-</span><span class="token token" style="color:#f08d49">1</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;[[&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;]]&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27; [...] &#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#f08d49">32</span><span class="token token" style="color:#ccc">)</span><span> </span><span class="token token" style="color:#cc99cd">as</span><span> snippet</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#67cdcc">*</span><span> </span><span class="token token" style="color:#cc99cd">from</span><span> indicator_search
</span></span><span><span></span><span class="token token" style="color:#cc99cd">where</span><span> indicator_search </span><span class="token token" style="color:#cc99cd">match</span><span> </span><span class="token token" style="color:#7ec699">&#x27;educatio*&#x27;</span><span>
</span></span><span><span></span><span class="token token" style="color:#cc99cd">order</span><span> </span><span class="token token" style="color:#cc99cd">by</span><span> rank
</span></span><span><span></span><span class="token token" style="color:#cc99cd">limit</span><span> </span><span class="token token" style="color:#f08d49">10</span></span></code></pre></div><div class="with-inner-title hanging"><div class="inner-title"><div role="button"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play" class="svg-inline--fa fa-play fa-w-14 fa-sm " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"></path></svg> Run</div></div><div style="padding-bottom:1ex"></div></div></div><div class="sqlite-httpvfs-demo"><div class="box-title">Demo</div><div class="with-inner-title"><div class="inner-title"><div>Input SQL</div><div role="button" class="floatright"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="keyboard" class="svg-inline--fa fa-keyboard fa-w-18 fa-sm " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path fill="currentColor" d="M528 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h480c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM128 180v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm-336 96v-40c0-6.627-5.373-12-12-12H76c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12zm288 0v-40c0-6.627-5.373-12-12-12H172c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h232c6.627 0 12-5.373 12-12zm96 0v-40c0-6.627-5.373-12-12-12h-40c-6.627 0-12 5.373-12 12v40c0 6.627 5.373 12 12 12h40c6.627 0 12-5.373 12-12z"></path></svg> Edit</div></div><pre class="inner" style="color:#ccc;background:#2d2d2d;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto"><code class="language-sql" style="color:#ccc;background:none;font-family:Consolas, Monaco, &#x27;Andale Mono&#x27;, &#x27;Ubuntu Mono&#x27;, monospace;font-size:1em;text-align:left;white-space:pre-wrap;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span><span class="token token" style="color:#cc99cd">insert</span><span> </span><span class="token token" style="color:#cc99cd">into</span><span> dom </span><span class="token token" style="color:#ccc">(</span><span>parent</span><span class="token token" style="color:#ccc">,</span><span> tagName</span><span class="token token" style="color:#ccc">,</span><span> textContent</span><span class="token token" style="color:#ccc">)</span><span>
</span></span><span><span>    </span><span class="token token" style="color:#cc99cd">select</span><span> </span><span class="token token" style="color:#7ec699">&#x27;ul#outtable1&#x27;</span><span class="token token" style="color:#ccc">,</span><span> </span><span class="token token" style="color:#7ec699">&#x27;li&#x27;</span><span class="token token" style="color:#ccc">,</span><span> long_name
</span></span><span><span>    </span><span class="token token" style="color:#cc99cd">from</span><span> wdi_country</span></span></code></pre></div><div class="with-inner-title hanging"><div class="inner-title"><div role="button"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play" class="svg-inline--fa fa-play fa-w-14 fa-sm " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M424.4 214.7L72.4 6.6C43.8-10.3 0 6.1 0 47.9V464c0 37.5 40.7 60.1 72.4 41.3l352-208c31.4-18.5 31.5-64.1 0-82.6z"></path></svg> Run</div></div><div style="padding-bottom:1ex"></div></div></div><p>Output:</p><div><ul id="outtable1"></div><div></ul></div></div><footer class="center w5 f6 tc mt4"><p><a href="https://github.com/phiresky/blog/blob/master/posts/2021/hosting-sqlite-databases-on-github-pages.md">View post source on GitHub</a></p></footer><div><script>/* yes, I know... fite me */
  (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
  function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
  e=o.createElement(i);r=o.getElementsByTagName(i)[0];
  e.src='https://www.google-analytics.com/analytics.js';
  r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
  ga('create','UA-39197996-3','auto');ga('send','pageview');
</script></div></main></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"filename":"2021/hosting-sqlite-databases-on-github-pages.md","frontmatter":{"csl":"../ieee-with-url.csl","date":"2021-04-17","hidden":true,"references":[],"subtitle":"(or any static file hoster)","title":"Hosting SQLite databases on Github Pages","url2cite-link-output":"sup"},"preview":"I was writing a tiny website to display statistics of how much sponsored content a Youtube creator has over time when I noticed that I often write a small tool as a website that queries some data from a database and then displays it in a graph, a table, or similar. But if you want to use a","content_ast":[{"t":"Para","c":[{"t":"Str","c":"I was writing "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"a tiny website to display statistics of how much sponsored content a Youtube creator has over time"}],["https://phiresky.github.io/youtube-sponsorship-stats/?uploader=Adam+Ragusea",""]]},{"t":"Str","c":" when I noticed that I often write a small tool as a website that queries some data from a database and then displays it in a graph, a table, or similar. But if you want to use a database, you either need to write a backend (which you then need to host forever) or download the whole dataset into the browser (which is not so great when the dataset is more than 10MB)."}]},{"t":"Para","c":[{"t":"Str","c":"In the past when I’ve used a backend server for these small side projects at some point some API goes down or a key expires or I forget about the backend and stop paying for whatever VPS it was on. Then when I revisit it years later, I’m annoyed that it’s gone and curse myself for relying on some external service (or myself caring over a longer period of time)."}]},{"t":"Para","c":[{"t":"Str","c":"Hosting a static website is much easier than a backend server - there’s many free and reliable options (like GitHub, GitLab Pages, Netlify, etc), and it scales to basically infinity without any effort."}]},{"t":"Para","c":[{"t":"Str","c":"So I wrote a tool to be able to use an SQL database in a statically hosted website!"}]},{"t":"Para","c":[{"t":"Str","c":"Here’s a demo using the "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"World Development Indicators dataset"}],["https://github.com/phiresky/world-development-indicators-sqlite/",""]]},{"t":"Str","c":" - a dataset with 6 tables and over 8 million rows (600MByte total)."}]},{"t":"CodeBlock","c":[["",["sqlite-httpvfs-demo","autorun","diffstat"],[]],"select country_code, long_name from wdi_country limit 3;"]},{"t":"Para","c":[{"t":"Str","c":"As you can see, we can query the "},{"t":"Code","c":[["",[],[]],"wdi_country"]},{"t":"Str","c":" table while only using 33kB of data!"}]},{"t":"Para","c":[{"t":"Str","c":"This is a full SQLite query engine. As such, we can use e.g. the "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"JSON functions"}],["https://www.sqlite.org/json1.html",""]]},{"t":"Str","c":" on our database:"}]},{"t":"CodeBlock","c":[["",["sqlite-httpvfs-demo","autorun"],[]],"select json_extract('{\"foo\": {\"bar\": 123}}', '$.foo.bar') as value"]},{"t":"Para","c":[{"t":"Str","c":"Note that this website is 100% hosted on a static file hoster (GitHub Pages)."}]},{"t":"Para","c":[{"t":"Str","c":"So how do you use a database on a static file hoster? Firstly, SQLite is compiled to WebAssembly. SQLite can be compiled with EMScripten without any modifications, and the "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"sql.js"}],["https://github.com/sql-js/sql.js/",""]]},{"t":"Str","c":" library is a thin JS wrapper around the wasm code."}]},{"t":"Para","c":[{"t":"Str","c":"sql.js only allows you to create and read from databases that are fully in memory though - so I implemented a virtual file system that fetches chunks of the database with HTTP Range requests when SQLite tries to read from the filesystem. From SQLite’s perspective, it just looks like it’s living on a normal computer with an empty filesystem except for a file called "},{"t":"Code","c":[["",[],[]],"/wdi.sqlite3"]},{"t":"Str","c":" that it can read from."}]},{"t":"Para","c":[{"t":"Str","c":"[info about pages / page sizes]"}]},{"t":"Para","c":[{"t":"Str","c":"Here’s an example of a simple index lookup query:"}]},{"t":"CodeBlock","c":[["",["sqlite-httpvfs-demo","diffstat","logPageReads","defaultPageReadTable"],[]],"select indicator_code from wdi_series where indicator_name\n    = 'Literacy rate, youth total (% of people ages 15-24)'"]},{"t":"Para","c":[{"t":"Str","c":"Run the above query and look at the page read log. SQLite does 7 page reads for that query."}]},{"t":"BulletList","c":[[{"t":"Plain","c":[{"t":"Str","c":"Three page reads are just schema reads (that are already cached)"}]}],[{"t":"Plain","c":[{"t":"Str","c":"Two page reads are the index lookup in the index "},{"t":"Code","c":[["",[],[]],"on wdi_series (indicator_name)"]}]}],[{"t":"Plain","c":[{"t":"Str","c":"Two page reads are on the "},{"t":"Code","c":[["",[],[]],"wdi_series"]},{"t":"Str","c":" table data."}]}]]},{"t":"Para","c":[{"t":"Str","c":"Both the index as well as the table reads are B-Tree lookups."}]},{"t":"Para","c":[{"t":"Str","c":"A more complex query: What are countries with the lowest youth literacy rate, based on the newest data from after 2010?"}]},{"t":"CodeBlock","c":[["",["sqlite-httpvfs-demo","diffstat","logPageReads"],[]],"with newest_datapoints as (\n  select country_code, indicator_code, max(year) as year from wdi_data\n  join wdi_series using (indicator_code)\n  where\n    indicator_name = 'Literacy rate, youth total (% of people ages 15-24)'\n    and year \u003e 2010\n  group by country_code\n)\nselect c.long_name as country, printf('%.1f %%', value) as \"Youth Literacy Rate\"\nfrom wdi_data\n  join wdi_country c using (country_code)\n  join newest_datapoints using (indicator_code, country_code, year)\norder by value asc limit 10"]},{"t":"Para","c":[{"t":"Str","c":"The above query should do around 30 GET requests, fetching a total of 200KiB."}]},{"t":"CodeBlock","c":[["",["sqlite-httpvfs-demo","diffstat","logPageReads"],[]],"select sum(length(long_definition)) from wdi_series;"]},{"t":"CodeBlock","c":[["",["sqlite-httpvfs-demo","diffstat","logPageReads"],[]],"select snippet(indicator_search, -1, '[[', ']]', ' [...] ', 32) as snippet, * from indicator_search\nwhere indicator_search match 'educatio*'\norder by rank\nlimit 10"]},{"t":"CodeBlock","c":[["",["sqlite-httpvfs-demo"],[]],"insert into dom (parent, tagName, textContent)\n    select 'ul#outtable1', 'li', long_name\n    from wdi_country"]},{"t":"Para","c":[{"t":"Str","c":"Output:"}]},{"t":"RawBlock","c":["html","\u003cul id=\"outtable1\"\u003e"]},{"t":"RawBlock","c":["html","\u003c/ul\u003e"]}],"default":{"filename":"2021/hosting-sqlite-databases-on-github-pages.md","frontmatter":{"csl":"../ieee-with-url.csl","date":"2021-04-17","hidden":true,"references":[],"subtitle":"(or any static file hoster)","title":"Hosting SQLite databases on Github Pages","url2cite-link-output":"sup"},"preview":"I was writing a tiny website to display statistics of how much sponsored content a Youtube creator has over time when I noticed that I often write a small tool as a website that queries some data from a database and then displays it in a graph, a table, or similar. But if you want to use a","content_ast":[{"t":"Para","c":[{"t":"Str","c":"I was writing "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"a tiny website to display statistics of how much sponsored content a Youtube creator has over time"}],["https://phiresky.github.io/youtube-sponsorship-stats/?uploader=Adam+Ragusea",""]]},{"t":"Str","c":" when I noticed that I often write a small tool as a website that queries some data from a database and then displays it in a graph, a table, or similar. But if you want to use a database, you either need to write a backend (which you then need to host forever) or download the whole dataset into the browser (which is not so great when the dataset is more than 10MB)."}]},{"t":"Para","c":[{"t":"Str","c":"In the past when I’ve used a backend server for these small side projects at some point some API goes down or a key expires or I forget about the backend and stop paying for whatever VPS it was on. Then when I revisit it years later, I’m annoyed that it’s gone and curse myself for relying on some external service (or myself caring over a longer period of time)."}]},{"t":"Para","c":[{"t":"Str","c":"Hosting a static website is much easier than a backend server - there’s many free and reliable options (like GitHub, GitLab Pages, Netlify, etc), and it scales to basically infinity without any effort."}]},{"t":"Para","c":[{"t":"Str","c":"So I wrote a tool to be able to use an SQL database in a statically hosted website!"}]},{"t":"Para","c":[{"t":"Str","c":"Here’s a demo using the "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"World Development Indicators dataset"}],["https://github.com/phiresky/world-development-indicators-sqlite/",""]]},{"t":"Str","c":" - a dataset with 6 tables and over 8 million rows (600MByte total)."}]},{"t":"CodeBlock","c":[["",["sqlite-httpvfs-demo","autorun","diffstat"],[]],"select country_code, long_name from wdi_country limit 3;"]},{"t":"Para","c":[{"t":"Str","c":"As you can see, we can query the "},{"t":"Code","c":[["",[],[]],"wdi_country"]},{"t":"Str","c":" table while only using 33kB of data!"}]},{"t":"Para","c":[{"t":"Str","c":"This is a full SQLite query engine. As such, we can use e.g. the "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"JSON functions"}],["https://www.sqlite.org/json1.html",""]]},{"t":"Str","c":" on our database:"}]},{"t":"CodeBlock","c":[["",["sqlite-httpvfs-demo","autorun"],[]],"select json_extract('{\"foo\": {\"bar\": 123}}', '$.foo.bar') as value"]},{"t":"Para","c":[{"t":"Str","c":"Note that this website is 100% hosted on a static file hoster (GitHub Pages)."}]},{"t":"Para","c":[{"t":"Str","c":"So how do you use a database on a static file hoster? Firstly, SQLite is compiled to WebAssembly. SQLite can be compiled with EMScripten without any modifications, and the "},{"t":"Link","c":[["",[],[]],[{"t":"Str","c":"sql.js"}],["https://github.com/sql-js/sql.js/",""]]},{"t":"Str","c":" library is a thin JS wrapper around the wasm code."}]},{"t":"Para","c":[{"t":"Str","c":"sql.js only allows you to create and read from databases that are fully in memory though - so I implemented a virtual file system that fetches chunks of the database with HTTP Range requests when SQLite tries to read from the filesystem. From SQLite’s perspective, it just looks like it’s living on a normal computer with an empty filesystem except for a file called "},{"t":"Code","c":[["",[],[]],"/wdi.sqlite3"]},{"t":"Str","c":" that it can read from."}]},{"t":"Para","c":[{"t":"Str","c":"[info about pages / page sizes]"}]},{"t":"Para","c":[{"t":"Str","c":"Here’s an example of a simple index lookup query:"}]},{"t":"CodeBlock","c":[["",["sqlite-httpvfs-demo","diffstat","logPageReads","defaultPageReadTable"],[]],"select indicator_code from wdi_series where indicator_name\n    = 'Literacy rate, youth total (% of people ages 15-24)'"]},{"t":"Para","c":[{"t":"Str","c":"Run the above query and look at the page read log. SQLite does 7 page reads for that query."}]},{"t":"BulletList","c":[[{"t":"Plain","c":[{"t":"Str","c":"Three page reads are just schema reads (that are already cached)"}]}],[{"t":"Plain","c":[{"t":"Str","c":"Two page reads are the index lookup in the index "},{"t":"Code","c":[["",[],[]],"on wdi_series (indicator_name)"]}]}],[{"t":"Plain","c":[{"t":"Str","c":"Two page reads are on the "},{"t":"Code","c":[["",[],[]],"wdi_series"]},{"t":"Str","c":" table data."}]}]]},{"t":"Para","c":[{"t":"Str","c":"Both the index as well as the table reads are B-Tree lookups."}]},{"t":"Para","c":[{"t":"Str","c":"A more complex query: What are countries with the lowest youth literacy rate, based on the newest data from after 2010?"}]},{"t":"CodeBlock","c":[["",["sqlite-httpvfs-demo","diffstat","logPageReads"],[]],"with newest_datapoints as (\n  select country_code, indicator_code, max(year) as year from wdi_data\n  join wdi_series using (indicator_code)\n  where\n    indicator_name = 'Literacy rate, youth total (% of people ages 15-24)'\n    and year \u003e 2010\n  group by country_code\n)\nselect c.long_name as country, printf('%.1f %%', value) as \"Youth Literacy Rate\"\nfrom wdi_data\n  join wdi_country c using (country_code)\n  join newest_datapoints using (indicator_code, country_code, year)\norder by value asc limit 10"]},{"t":"Para","c":[{"t":"Str","c":"The above query should do around 30 GET requests, fetching a total of 200KiB."}]},{"t":"CodeBlock","c":[["",["sqlite-httpvfs-demo","diffstat","logPageReads"],[]],"select sum(length(long_definition)) from wdi_series;"]},{"t":"CodeBlock","c":[["",["sqlite-httpvfs-demo","diffstat","logPageReads"],[]],"select snippet(indicator_search, -1, '[[', ']]', ' [...] ', 32) as snippet, * from indicator_search\nwhere indicator_search match 'educatio*'\norder by rank\nlimit 10"]},{"t":"CodeBlock","c":[["",["sqlite-httpvfs-demo"],[]],"insert into dom (parent, tagName, textContent)\n    select 'ul#outtable1', 'li', long_name\n    from wdi_country"]},{"t":"Para","c":[{"t":"Str","c":"Output:"}]},{"t":"RawBlock","c":["html","\u003cul id=\"outtable1\"\u003e"]},{"t":"RawBlock","c":["html","\u003c/ul\u003e"]}]}}},"__N_SSG":true},"page":"/[year]/[post]","query":{"year":"2021","post":"hosting-sqlite-databases-on-github-pages"},"buildId":"tMeAkpABQZgSro6YLlMSH","assetPrefix":"/blog","isFallback":false,"dynamicIds":[7378,1542,4246,1535,3577,1426,3615,1102,8772,3323,3247,331,7274,9588,312,505,1005,1259,1357,1403,1756,1792,1895,2202,2909,3365,3486,3681,4072,4829,5325,6302,6303,1422,5889,null],"gsp":true}</script><script nomodule="" src="/blog/_next/static/chunks/polyfills-7f99f00b02c1734b8752.js"></script><script async="" src="/blog/_next/static/chunks/d9daaaae.44a96f54a4d072574e74.js"></script><script async="" src="/blog/_next/static/chunks/9598fa14.8828868ff96a6326c25a.js"></script><script async="" src="/blog/_next/static/chunks/186.2695ab59e33fe47cdc32.js"></script><script async="" src="/blog/_next/static/chunks/305.3a2900c6989f0f36c437.js"></script><script src="/blog/_next/static/chunks/webpack-876742803a46f28db309.js" async=""></script><script src="/blog/_next/static/chunks/framework-f2b6a0e2c4347cd67771.js" async=""></script><script src="/blog/_next/static/chunks/commons-020e121c3d1a2701efcc.js" async=""></script><script src="/blog/_next/static/chunks/main-474bf01cc279f00c3383.js" async=""></script><script src="/blog/_next/static/chunks/pages/_app-c1531b3097afafc34a15.js" async=""></script><script src="/blog/_next/static/chunks/247-03c5f887de49cc28342f.js" async=""></script><script src="/blog/_next/static/chunks/120-4c18c374c3271b149473.js" async=""></script><script src="/blog/_next/static/chunks/pages/%5Byear%5D/%5Bpost%5D-d896f37a01124ade98ac.js" async=""></script><script src="/blog/_next/static/tMeAkpABQZgSro6YLlMSH/_buildManifest.js" async=""></script><script src="/blog/_next/static/tMeAkpABQZgSro6YLlMSH/_ssgManifest.js" async=""></script></body></html>